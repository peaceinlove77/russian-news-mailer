# GitHub Actions 워크플로우 이름
name: Daily Russian News Mailer

# 이 워크플로우를 언제 실행할지 설정
on:
  # 매일 UTC 22시(한국 시간 오전 7시)에 실행
  schedule:
    - cron: '0 22 * * *'
  # 수동으로 실행할 수 있도록 버튼 추가
  workflow_dispatch:

# 실행할 작업(Job) 정의
jobs:
  build-and-send-email:
    # 우분투 최신 버전 환경에서 실행
    runs-on: ubuntu-latest

    # 작업 단계(Step) 정의
    steps:
      # 1. 저장소에 있는 코드를 가져옴
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2. 파이썬 환경 설정
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      # 3. 필요한 파이썬 라이브러리 설치
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install feedparser openai sendgrid requests

      # 4. 파이썬 스크립트 실행
      - name: Run Python script
        # GitHub Secrets에 저장된 값들을 환경 변수로 설정하여 스크립트에 전달
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          SENDGRID_API_KEY: ${{ secrets.SENDGRID_API_KEY }}
          FROM_EMAIL: ${{ secrets.FROM_EMAIL }}
          TO_EMAIL: ${{ secrets.TO_EMAIL }}
        run: python main.py
